[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.11046885.svg)](https://doi.org/10.5281/zenodo.11046885)

# KEY POINTS
1. Building indexes is NOT included in elpsed time.
2. Call for software packaging.

# Prerequisite
1. (Done) Get the dataset: download [SRA-Toolkits](https://github.com/ncbi/sra-tools/wiki/01.-Downloading-SRA-Toolkit), Ver3.1.1; and [poly dataset](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM7051146), change the URL with 46/47/48
    - The files are already on the hpc5000. You can `scp` it.
1. download [HISAT-3N](http://daehwankimlab.github.io/hisat2/hisat-3n/), Ver latest
2. download [SRA-Toolkits](https://github.com/ncbi/sra-tools/wiki/01.-Downloading-SRA-Toolkit), Ver3.1.1
4. download [samtools](https://github.com/samtools/samtools/blob/develop/INSTALL) Ver1.21
    - have TINY demand for dependency: `sudo apt-get install autoconf automake make gcc perl zlib1g-dev libbz2-dev liblzma-dev libcurl4-gnutls-dev libssl-dev libncurses5-dev libdeflate-dev`
    - my configuration command: `./configure CC=mpicc`
    - make and make install with `-j $(nproc)`
    > may ADD a `--prefix` to avoid super user privildge.
6. download [cutseq](https://github.com/y9c/cutseq)
7. download Java(Ver 11), and configure `umicollapse.jar` according to the [repo](https://github.com/Daniel-Liu-c0deb0t/UMICollapse/tree/master)

# Workflow
All the scripts have been tested. Details in `./script`
**vtune profiler results** of (1)the whole workflow and (2)an apperantly time-consuming site calling and flitering process(command started with samtool view -e "rlen<100000") is compressed in tar file. (Available on hpc5000)
## How to replicate the workflow on your own pc 
1. clone the `Optimization` repo
2. `scp` the files in `process` / `ncrna_ref` / `ref` directories to own pc
3. run the script under `./Optimization` directory with command `./script/stage1_SRRXXX.sh`(replace the XXX with the file number)

### Notes
1. You don't need to rerun `pre.sh` anymore. Only needed to executed once to generate `ref` and `ncra_ref` directories, which should be already there on the hpc5000. (More to see in the next session)
2. `stage1_SRRXXX.sh` should all be run first, then `stage2.sh` at last. Because stage2 depends on all the stage1 outputs.
3. Keep the structure of files(see next sesson) unchanged. The scripts use the relative path.
4. If you wanna use vtune to profile it, remove the first and last command in `stage1_SRRXXX.sh` because the pytrace cannot trace the python script. And time consumed by python scripts is **negeligible**.

# Structre of files
```
.
├── ncrna_ref (generated by pre.sh)
│
├── Optimization (clone from original repo)
│   ├── bin
│   ├── config.yaml
│   ├── data
│   ├── docs
│   ├── output (added, store the ultimate result)
│   ├── README.md
│   ├── script (added, encapsulate the workflow)
│   │   ├── pre.sh
│   │   ├── stage1_SRR23538290.sh
│   │   ├── stage1_SRR23538291.sh
│   │   ├── stage1_SRR23538292.sh
│   │   └── stage2.sh
│   └── Snakefile (it is out of date according to the issue)
├── process (data generated during the process)
│   ├── GT (Ground truth reference file)
│   ├── SRR23538290
│   ├── SRR23538291
│   ├── SRR23538292
│   └── WT
└── ref (genreated by pre.sh)
```

# HW requirement
1. (Not quite sure) 32G RAM
2. 327G disk total

---
# Origin stuff (Haven't changed)

# m<sup>5</sup>C-UBSseq

## Changelog

- 4/23/2024: rewrite code using polars

## workflow

[![](./docs/flow.svg)](https://github.com/y9c/m5C-UBSseq)

## Citation

- cite this software

  ```BibTex
  @software{chang_y_2024_11046885,
      author    = {Chang Y},
      title     = {y9c/m5C-UBSseq: V0.1},
      publisher = {Zenodo},
      version   = {v0.1},
      doi       = {10.5281/zenodo.11046885},
      url       = {https://doi.org/10.5281/zenodo.11046885}
  }
  ```

- cite the method

  ```BibTex
  @article{dai_ultrafast_2024,
      title = {Ultrafast bisulfite sequencing detection of 5-methylcytosine in {DNA} and {RNA}},
      url = {https://www.nature.com/articles/s41587-023-02034-w},
      doi = {10.1038/s41587-023-02034-w},
      author = {Dai, Qing and Ye, Chang and Irkliyenko, Iryna and Wang, Yiding and Sun, Hui-Lung and Gao, Yun and Liu, Yushuai and Beadell, Alana and Perea, José and Goel, Ajay and He, Chuan},
      date = {2024-01-02},
  }
  ```

&nbsp;

<p align="center">
<img
  src="https://raw.githubusercontent.com/y9c/y9c/master/resource/footer_line.svg?sanitize=true"
/>
</p>
<p align="center">
Copyright &copy; 2021-present
<a href="https://github.com/y9c" target="_blank">Chang Y</a>
</p>
<p align="center">
